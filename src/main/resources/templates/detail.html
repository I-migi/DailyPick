<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì˜í™” ìƒì„¸</title>
    <link rel="stylesheet" href="/css/detail.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body class="dark-mode">
<header class="navbar">
    <div class="logo"><a href="/">ğŸ¬ DailyPick</a></div>
    <nav>
        <a href="/user/myPage">ë§ˆì´í˜ì´ì§€</a>
        <a href="/user/logout">ë¡œê·¸ì•„ì›ƒ</a>
    </nav>
</header>

<main class="detail-container">
    <div class="poster">
        <img src="" alt="í¬ìŠ¤í„°" />
    </div>

    <div class="info">
        <h1>ì˜í™” ì œëª©</h1>
        <p class="original-title">ì›ì œ: </p>
        <p class="release-date">ê°œë´‰ì¼: <span></span></p>
        <p class="vote">í‰ì : <span></span> / 10</p>
        <p class="overview">ì¤„ê±°ë¦¬</p>

        <div class="genres"></div>
    </div>
    <!-- ë¦¬ë·° ì‘ì„± ì„¹ì…˜ -->
    <section class="review-form-section">
        <h2>ğŸ“ ë¦¬ë·° ì‘ì„±í•˜ê¸°</h2>
        <form method="post" action="/review">
            <input type="hidden" name="movieId" th:value="${movieId}" />

            <label for="comment">ì½”ë©˜íŠ¸</label>
            <textarea id="comment" name="comment" rows="4" required></textarea>

            <label for="rate">í‰ì  (0.0 ~ 5.0)</label>
            <input type="number" id="rate" name="rate" step="0.1" min="0" max="5" required />

            <button type="submit">ë¦¬ë·° ì‘ì„±</button>
        </form>
    </section>

    <!-- ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
    <section class="review-list-section">
        <h2>ğŸ“ƒ ë¦¬ë·° ëª©ë¡</h2>
        <div id="reviewList">
            <p>ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </section>




</main>

<footer class="footer">
    &copy; 2025 DailyPick | All rights reserved
</footer>

<!-- movieIdë¥¼ JSì—ì„œ ì•ˆì „í•˜ê²Œ ì‚¬ìš© -->
<script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", () => {
        const movieId = [[${movieId}]];

        if (!movieId || movieId === 0) {
            alert("ì˜ëª»ëœ ì˜í™” IDì…ë‹ˆë‹¤.");
            return;
        }

        fetch(`/api/movies/detail?movieId=${movieId}`)
            .then(res => res.json())
            .then(data => {
                document.querySelector("h1").textContent = data.title;
                document.querySelector(".original-title").textContent = "ì›ì œ: " + data.original_title;
                document.querySelector(".release-date span").textContent = data.release_date;
                document.querySelector(".vote span").textContent = data.vote_average;
                document.querySelector(".overview").textContent = data.overview;
                document.querySelector(".poster img").src = `https://image.tmdb.org/t/p/w500${data.poster_path}`;
                document.querySelector(".poster img").alt = data.title;

                const genresContainer = document.querySelector(".genres");
                genresContainer.innerHTML = "";

                data.genres.forEach(g => {
                    const span = document.createElement("span");
                    span.className = "genre";
                    span.textContent = g.name;
                    genresContainer.appendChild(span);
                });
            })
            .catch(err => {
                console.error("Failed to load movie detail", err);
            });

        fetch(`/api/reviews?movieId=${movieId}`)
            .then(res => res.json())
            .then(reviews => {
                const reviewList = document.getElementById("reviewList");
                reviewList.innerHTML = "";

                if (reviews.length === 0) {
                    reviewList.innerHTML = "<p>ì•„ì§ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë¦¬ë·°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</p>";
                    return;
                }

                reviews.forEach(review => {
                    const div = document.createElement("div");
                    div.className = "review-item";
                    div.innerHTML = `
    <p><strong>${review.userName}</strong> <span class="rating">â­ ${review.rating}ì </span></p>
    <p>${review.comment}</p>
`;

                    reviewList.appendChild(div);
                });
            })
            .catch(err => {
                console.error("ë¦¬ë·° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
                document.getElementById("reviewList").innerHTML = "<p>ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>";
            });
    });
</script>
</body>
</html>
